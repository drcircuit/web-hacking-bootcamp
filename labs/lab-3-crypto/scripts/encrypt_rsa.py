from Crypto.Util.number import getPrime, inverse, bytes_to_long
from pathlib import Path

e = 65537
key_size = 1024

# Generate Fermat-vulnerable primes
p = 22185037223948354624832661150445146499368289586907723121089858671438225099558000000838563837129594930325756941561042832784009974999416335133747677877801466236143003084485894772940891606408302694190881832130758817334060799309056181936059876319283218776920192265124946283482429332760359877836042182910415486518472207770792489709292174100696262096986219475261750600631262205955491723857389350025130689241019954039621054320842194744830937329673214245842313872025982123024581266368254438442829608949822297839594644110012866149374525267770241417108422415805810287700323995021111152732058614641511117931939735680930008436477
q = 22185037223948354624832661150445146499368289586907723121089858671438225099558000000838563837129594930325756941561042832784009974999416335133747677877801466236143003084485894772940891606408302694190881832130758817334060799309056181936059876319283218776920192265124946283482429332760359877836042182910415486518472207770792489709292174100696262096986219475261750600631262205955491723857389350025130689241019954039621054320842194744830937329673214245842313872025982123024581266368254438442829608949822297839594644110012866149374525267770241417108422415805810287700323995021111152732058614641511117931939735680930008435811
phi = (p - 1) * (q - 1)

d = inverse(e, phi)
n = p * q

# Load plaintext from temp file
plain_path = Path("/tmp/report_plain.txt")
msg = plain_path.read_bytes()
c = pow(bytes_to_long(msg), e, n)

# Write public key to web root
Path("/var/www/html/public.txt").write_text(f"n = {n}\ne = {e}\n")

# Write encrypted message to thanos's home folder
Path("/home/thanos/report.txt.enc").write_text(str(c))

# Delete the plaintext
plain_path.unlink()